# 预设管理器 (Momo) - Preset Manager (Momo)

**一个为 SillyTavern 设计的、功能强大且高度专业化的预设（Preset）管理与AI辅助编辑扩展。**

该项目旨在提供一套完整的预设管理工具集，从基础的预设切换、编辑，到高级的批量操作和AI辅助功能，帮助用户高效地创建、维护和使用SillyTavern的AI生成参数。

## ✨ 核心功能

- **🗂️ 预设管理 (Preset Management)**:
    - **加载与切换**: 在一个独立的浮动窗口中，快速查看并加载SillyTavern中所有已保存的预设。当前激活的预设会高亮显示。
    - **删除**: 从列表中快速移除不再需要的预设。

- **✍️ 高级编辑 (Advanced Editing)**:
    - **手动编辑**: 提供一个类似SillyTavern原生UI的表单界面，允许用户直观地查看和修改预设中所有`params`条目的各项属性（如 `temperature`, `top_p` 等），支持文本、数字、布尔值等多种类型。

- **🤖 AI 辅助功能 (AI-Powered Features)**:
    - **AI 辅助修改**: 在“高级编辑”视图中，用户可以通过自然语言描述修改要求，插件将调用AI来智能地修改预设中特定条目的值。
    - **AI 创建条目**: 在独立的“AI创建条目”视图中，用户可以通过自然语言描述需求，插件将调用AI自动生成一个包含名称和内容的全新条目，并将其添加到指定预设中。

- **🧰 批量操作 (Bulk Operations)**:
    - **批量删除预设**: 在专门的视图中，通过多选框选择多个预设进行一次性批量删除。
    - **批量删除条目**: 在同一视图中，可以从单个预设中选择多个条目进行批量删除。
    - **条目复制 (Transfer)**: 在专门的视图中，选择一个源预设和一个目标预设，然后通过多选框选择源预设中的特定条目，将其快速复制到目标预设中。这对于组合和测试不同的参数配置非常有用。

- **🎨 统一且流畅的UI/UX**:
    - **浮动窗口**: 通过一个可拖动的浮动按钮打开和关闭插件主界面，不影响主聊天窗口的操作。
    - **多视图切换**: 插件内部包含主视图、编辑、删除、复制、AI创建等多个逻辑分离的视图，通过清晰的按钮导航进行切换，操作流程符合直觉。
    - **移动端适配**: 所有界面均经过精心优化，确保在移动设备上也能完美显示和操作。
    - **无缝风格**: 插件UI风格与SillyTavern的现代界面保持一致，提供沉浸式的用户体验。

## 🚀 安装方法

SillyTavern 支持直接通过链接安装扩展，这是最推荐的安装方式。

1.  打开 SillyTavern，点击右上角的 **扩展** 图标 (一个骰子 🎲 的形状)。
2.  在扩展页面中，点击 **下载扩展/更新** (Download Extension / Update) 按钮。
3.  将以下仓库链接粘贴到输入框内：
    ```
    https://github.com/your-github-username/preset-manager-momo.git
    ```
    _(请记得替换 `your-github-username` 为实际的用户名)_
4.  点击 `Download` 进行安装。
5.  安装完成后，系统可能会提示您重新加载UI，请按提示操作。
6.  在扩展列表中找到并启用 "Preset Manager (Momo)"。
7.  屏幕上会出现一个新的浮动按钮，点击即可打开插件界面。

## 📜 开发日志

### **版本 1.2.0 (2025-06-24)**

- **【UI/UX重构】**: 根据用户反馈，对“AI创建条目”功能进行了重大重构。
- **重构详情**:
    1.  **界面分离**: 将“AI创建条目”功能从混乱的主视图中剥离，迁移到一个独立的、专用的子页面（视图）。
    2.  **流程优化**: 在主视图底部添加了一个清晰的“✨ AI创建条目”按钮，点击后会平滑地切换到新视图，使用户操作流程更符合逻辑、更清晰。
    3.  **代码优化**: 对 `index.js` 和 `popup.html` 进行了同步重构，确保了视图切换逻辑的稳定性和代码的可维护性。
- **最终效果**: 插件主界面变得更加整洁，核心功能分区明确，提升了整体的用户体验。

### **版本 1.1.2 (2025-06-24)**

- **【核心重写】**: 根据用户的最终指示，彻底重写了“条目复制”功能的核心逻辑。
- **修复详情**:
    1.  **全面同步**: 新逻辑会检测目标预设中**所有**存在的`character_id`列表（包括默认和所有角色专用列表）。
    2.  **同步添加**: 将新复制的条目数据**同时添加**到`prompts`数据库和**所有**检测到的`prompt_order`显示列表中。
    3.  **错误修复**: 移除了一个不存在的`reloadPrompts()`函数调用，该调用此前会导致功能成功但UI弹出错误提示。
- **最终效果**: “条目复制”功能现在可以完美地一步到位，将条目添加到所有相关列表，且无任何错误提示。

### **版本 1.1.1 (2025-06-24)**

- **【核心修复】**: 彻底解决了“条目复制”功能的核心Bug。此前，插件在复制条目时，只更新了预设文件中的 `prompts` 数组（条目数据库），却忽略了更新至关重要的 `prompt_order` 数组（条目显示列表）。这导致SillyTavern虽然接收了新条目的数据，但在主界面上却无法渲染它们。
- **修复详情**: 新的逻辑确保在复制条目时，会同时将条目的完整数据添加到 `prompts` 数组，并将其ID和启用状态添加到 `prompt_order` 数组中。这保证了数据操作的完整性，使SillyTavern能够正确识别并显示所有被复制的新条目。

### **版本 1.1.0 (2025-06-24)**

- **修复**: 修正了“批量删除”视图中条目列表的渲染逻辑，使其与新的 `prompts` 数组数据结构保持一致，解决了条目显示不正确的问题。
- **修复**: 解决了在“高级编辑”中保存任何更改（包括条目内容、高级参数）后，页面会意外跳转回主视图的问题。现在插件会正确地停留在编辑界面并刷新数据，保持操作的连续性。
- **优化**: 改进了所有删除操作（单个预设、批量预设、批量条目）的用户体验。现在删除后，项目会立即从UI中消失，无需等待或手动刷新，提供了更流畅的即时反馈。
- **修复**: 修正了在“批量删除条目”功能中，即使删除成功也会错误地弹出“删除失败”提示的Bug。
- **修复**: 统一了“条目复制”功能的数据处理方式，使其能够正确地显示和复制基于新 `prompts` 数组的条目。
